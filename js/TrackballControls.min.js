/**
 * @author Eberhard Graether / http://egraether.com/
 * @author Mark Lundin 	/ http://mark-lundin.com
 * @author Simone Manini / http://daron1337.github.io
 * @author Luca Antiga 	/ http://lantiga.github.io
 */
THREE.TrackballControls=function(e,t){var o=this,n={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.target=new THREE.Vector3;var s=new THREE.Vector3,c=n.NONE,i=n.NONE,a=new THREE.Vector3,r=new THREE.Vector2,p=new THREE.Vector2,h=new THREE.Vector3,d=0,u=new THREE.Vector2,E=new THREE.Vector2,m=0,l=0,g=new THREE.Vector2,y=new THREE.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone();var v={type:"change"},w={type:"start"},T={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}},this.handleEvent=function(e){"function"==typeof this[e.type]&&this[e.type](e)};var b,f,O,R,H,L,V,k,N,j,A,D=(b=new THREE.Vector2,function(e,t){return b.set((e-o.screen.left)/o.screen.width,(t-o.screen.top)/o.screen.height),b}),Y=function(){var e=new THREE.Vector2;return function(t,n){return e.set((t-.5*o.screen.width-o.screen.left)/(.5*o.screen.width),(o.screen.height+2*(o.screen.top-n))/o.screen.width),e}}();function C(e){!1!==o.enabled&&(window.removeEventListener("keydown",C),i=c,c===n.NONE&&(e.keyCode!==o.keys[n.ROTATE]||o.noRotate?e.keyCode!==o.keys[n.ZOOM]||o.noZoom?e.keyCode!==o.keys[n.PAN]||o.noPan||(c=n.PAN):c=n.ZOOM:c=n.ROTATE))}function P(e){!1!==o.enabled&&(c=i,window.addEventListener("keydown",C,!1))}function X(e){!1!==o.enabled&&(e.preventDefault(),e.stopPropagation(),c===n.NONE&&(c=e.button),c!==n.ROTATE||o.noRotate?c!==n.ZOOM||o.noZoom?c!==n.PAN||o.noPan||(g.copy(D(e.pageX,e.pageY)),y.copy(g)):(u.copy(D(e.pageX,e.pageY)),E.copy(u)):(p.copy(Y(e.pageX,e.pageY)),r.copy(p)),document.addEventListener("mousemove",M,!1),document.addEventListener("mouseup",Z,!1),o.dispatchEvent(w))}function M(e){!1!==o.enabled&&(e.preventDefault(),e.stopPropagation(),c!==n.ROTATE||o.noRotate?c!==n.ZOOM||o.noZoom?c!==n.PAN||o.noPan||y.copy(D(e.pageX,e.pageY)):E.copy(D(e.pageX,e.pageY)):(r.copy(p),p.copy(Y(e.pageX,e.pageY))))}function Z(e){!1!==o.enabled&&(e.preventDefault(),e.stopPropagation(),c=n.NONE,document.removeEventListener("mousemove",M),document.removeEventListener("mouseup",Z),o.dispatchEvent(T))}function S(e){if(!1!==o.enabled&&!0!==o.noZoom){switch(e.preventDefault(),e.stopPropagation(),e.deltaMode){case 2:u.y-=.025*e.deltaY;break;case 1:u.y-=.01*e.deltaY;break;default:u.y-=25e-5*e.deltaY}o.dispatchEvent(w),o.dispatchEvent(T)}}function x(e){if(!1!==o.enabled){switch(e.touches.length){case 1:c=n.TOUCH_ROTATE,p.copy(Y(e.touches[0].pageX,e.touches[0].pageY)),r.copy(p);break;default:c=n.TOUCH_ZOOM_PAN;var t=e.touches[0].pageX-e.touches[1].pageX,s=e.touches[0].pageY-e.touches[1].pageY;l=m=Math.sqrt(t*t+s*s);var i=(e.touches[0].pageX+e.touches[1].pageX)/2,a=(e.touches[0].pageY+e.touches[1].pageY)/2;g.copy(D(i,a)),y.copy(g)}o.dispatchEvent(w)}}function z(e){if(!1!==o.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:r.copy(p),p.copy(Y(e.touches[0].pageX,e.touches[0].pageY));break;default:var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;l=Math.sqrt(t*t+n*n);var s=(e.touches[0].pageX+e.touches[1].pageX)/2,c=(e.touches[0].pageY+e.touches[1].pageY)/2;y.copy(D(s,c))}}function _(e){if(!1!==o.enabled){switch(e.touches.length){case 0:c=n.NONE;break;case 1:c=n.TOUCH_ROTATE,p.copy(Y(e.touches[0].pageX,e.touches[0].pageY)),r.copy(p)}o.dispatchEvent(T)}}function q(e){!1!==o.enabled&&e.preventDefault()}this.rotateCamera=(O=new THREE.Vector3,R=new THREE.Quaternion,H=new THREE.Vector3,L=new THREE.Vector3,V=new THREE.Vector3,k=new THREE.Vector3,function(){k.set(p.x-r.x,p.y-r.y,0),(f=k.length())?(a.copy(o.object.position).sub(o.target),H.copy(a).normalize(),L.copy(o.object.up).normalize(),V.crossVectors(L,H).normalize(),L.setLength(p.y-r.y),V.setLength(p.x-r.x),k.copy(L.add(V)),O.crossVectors(k,a).normalize(),f*=o.rotateSpeed,R.setFromAxisAngle(O,f),a.applyQuaternion(R),o.object.up.applyQuaternion(R),h.copy(O),d=f):!o.staticMoving&&d&&(d*=Math.sqrt(1-o.dynamicDampingFactor),a.copy(o.object.position).sub(o.target),R.setFromAxisAngle(h,d),a.applyQuaternion(R),o.object.up.applyQuaternion(R)),r.copy(p)}),this.zoomCamera=function(){var e;c===n.TOUCH_ZOOM_PAN?(e=m/l,m=l,a.multiplyScalar(e)):(1!==(e=1+(E.y-u.y)*o.zoomSpeed)&&e>0&&a.multiplyScalar(e),o.staticMoving?u.copy(E):u.y+=(E.y-u.y)*this.dynamicDampingFactor)},this.panCamera=(N=new THREE.Vector2,j=new THREE.Vector3,A=new THREE.Vector3,function(){N.copy(y).sub(g),N.lengthSq()&&(N.multiplyScalar(a.length()*o.panSpeed),A.copy(a).cross(o.object.up).setLength(N.x),A.add(j.copy(o.object.up).setLength(N.y)),o.object.position.add(A),o.target.add(A),o.staticMoving?g.copy(y):g.add(N.subVectors(y,g).multiplyScalar(o.dynamicDampingFactor)))}),this.checkDistances=function(){o.noZoom&&o.noPan||(a.lengthSq()>o.maxDistance*o.maxDistance&&(o.object.position.addVectors(o.target,a.setLength(o.maxDistance)),u.copy(E)),a.lengthSq()<o.minDistance*o.minDistance&&(o.object.position.addVectors(o.target,a.setLength(o.minDistance)),u.copy(E)))},this.update=function(){a.subVectors(o.object.position,o.target),o.noRotate||o.rotateCamera(),o.noZoom||o.zoomCamera(),o.noPan||o.panCamera(),o.object.position.addVectors(o.target,a),o.checkDistances(),o.object.lookAt(o.target),s.distanceToSquared(o.object.position)>1e-6&&(o.dispatchEvent(v),s.copy(o.object.position))},this.reset=function(){c=n.NONE,i=n.NONE,o.target.copy(o.target0),o.object.position.copy(o.position0),o.object.up.copy(o.up0),a.subVectors(o.object.position,o.target),o.object.lookAt(o.target),o.dispatchEvent(v),s.copy(o.object.position)},this.dispose=function(){this.domElement.removeEventListener("contextmenu",q,!1),this.domElement.removeEventListener("mousedown",X,!1),this.domElement.removeEventListener("wheel",S,!1),this.domElement.removeEventListener("touchstart",x,!1),this.domElement.removeEventListener("touchend",_,!1),this.domElement.removeEventListener("touchmove",z,!1),document.removeEventListener("mousemove",M,!1),document.removeEventListener("mouseup",Z,!1),window.removeEventListener("keydown",C,!1),window.removeEventListener("keyup",P,!1)},this.domElement.addEventListener("contextmenu",q,!1),this.domElement.addEventListener("mousedown",X,!1),this.domElement.addEventListener("wheel",S,!1),this.domElement.addEventListener("touchstart",x,!1),this.domElement.addEventListener("touchend",_,!1),this.domElement.addEventListener("touchmove",z,!1),window.addEventListener("keydown",C,!1),window.addEventListener("keyup",P,!1),this.handleResize(),this.update()},THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.TrackballControls.prototype.constructor=THREE.TrackballControls;